!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=124)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=o(n(1)),a=o(n(4));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return r(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new a.default("parse","",{line:19,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],n=0;n<16;n++)t.push(e.readUint8())}},{key:"readBody",value:function(t){var n=this.size-t.position+this.start,r=this.type;this.data=t.buffer.slice(t.position,t.position+n),t.position+=this.data.byteLength;var i=void 0;(i=e.containerBox.find(function(e){return e===r})?e.containerParser:e[r])&&i instanceof Function&&i.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new i.default(this.data),n=t.buffer.byteLength;t.position<n;){var r=new e;r.readHeader(t),this.subBox.push(r),r.readBody(t)}delete this.data,t=null}}]),e}();u.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra"],t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(4));var a=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof ArrayBuffer))throw new i.default("parse","",{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return r(e,[{key:"skip",value:function(t){for(var n=Math.floor(t/4),r=t%4,i=0;i<n;i++)e.readByte(this.dataview,4);r>0&&e.readByte(this.dataview,r)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,n){var r=void 0;switch(t){case 1:r=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:r=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw"not supported for readByte 3";r=e.getUint8(e.position)<<16,r|=e.getUint8(e.position+1)<<8,r|=e.getUint8(e.position+2);break;case 4:r=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw new i.default("parse","",{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});r=e.getUint32(e.position)<<32,r|=e.getUint32(e.position+4);break;default:r=""}return e.position+=t,r}}]),e}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,n){"use strict";var r=n(122)("wks"),i=n(33),a=n(2).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(n(19)),i=n(82);var a=function(e){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.version=i.version;var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));return o.url=a,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.default.Errors),t}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return"object"===(void 0===e?"undefined":r(e))?null!==e:"function"==typeof e}},function(e,t,n){"use strict";var r=n(5);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){"use strict";var r=e.exports={version:"2.5.7"};"number"==typeof __e&&(__e=r)},function(e,t,n){"use strict";e.exports=!n(30)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){"use strict";var r=n(9);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return r(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";var r=n(92)();e.exports=function(e){return e!==r&&null!==e}},function(e,t,n){"use strict";var r,i,a,o,u,s,f,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=n(99),l=n(85),h=Function.prototype.apply,v=Function.prototype.call,p=Object.create,m=Object.defineProperty,y=Object.defineProperties,b=Object.prototype.hasOwnProperty,w={configurable:!0,enumerable:!1,writable:!0};u={on:r=function(e,t){var n;return l(t),b.call(this,"__ee__")?n=this.__ee__:(n=w.value=p(null),m(this,"__ee__",w),w.value=null),n[e]?"object"===c(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:i=function(e,t){var n,i;return l(t),i=this,r.call(this,e,n=function(){a.call(i,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},off:a=function(e,t){var n,r,i,a;if(l(t),!b.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"===(void 0===(r=n[e])?"undefined":c(r)))for(a=0;i=r[a];++a)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[a?0:1]:r.splice(a,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:o=function(e){var t,n,r,i,a;if(b.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"===(void 0===i?"undefined":c(i))){for(n=arguments.length,a=new Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)h.call(r,this,a)}else switch(arguments.length){case 1:v.call(i,this);break;case 2:v.call(i,this,arguments[1]);break;case 3:v.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=new Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];h.call(i,this,a)}}},s={on:d(r),once:d(i),off:d(a),emit:d(o)},f=y({},s),e.exports=t=function(e){return null==e?p(f):y(Object(e),s)},t.methods=u},function(e,t,n){"use strict";var r=n(6),i=n(121),a=n(120),o=Object.defineProperty;t.f=n(8)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=o(n(13)),a=o(n(4));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(0,i.default)(this),this.url=t,this.range=n,this.id=n.join("-"),this.on=!1;var o=new window.XMLHttpRequest;o.target=this,o.responseType="arraybuffer",o.open("get",t),o.setRequestHeader("Range","bytes="+n[0]+"-"+n[1]),o.onload=function(){200!==o.status&&206!==o.status||r&&r instanceof Function&&r(o.response),o.target.remove()},o.onerror=function(e){o.target.emit("error",new a.default("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),o.target.remove()},o.onabort=function(){o.target.remove()},this.xhr=o,e.queue.push(this),this.update()}return r(e,[{key:"cancel",value:function(){this.xhr.abort()}},{key:"remove",value:function(){var t=this;e.queue.filter(function(n,r){return n.url===t.url&&n.id===t.id&&(e.queue.splice(r,1),!0)}),this.update()}},{key:"update",value:function(){var t=e.queue,n=t.filter(function(e){return e.on}),r=t.filter(function(e){return!e.on}),i=e.limit-n.length;r.forEach(function(e,t){t<i&&e.run()})}},{key:"run",value:function(){1===this.xhr.readyState?(this.on=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(){e.queue.forEach(function(e){e.on&&e.cancel()}),e.queue.length=0}}]),e}();u.queue=[],u.limit=2,window.Task=u,t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(18));var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=new Uint8Array(0)}return r(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach(function(t){t?e.buffer=(0,i.default)(Uint8Array,e.buffer,t):window.console.error(t)})}}],[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}();t.default=a,e.exports=t.default},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(81));e.exports=r.default},function(e,t){e.exports=Player},function(e,t,n){"use strict";e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){"use strict";var r=n(2).navigator;e.exports=r&&r.userAgent||""},function(e,t,n){"use strict";var r=n(9);e.exports.f=function(e){return new function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=r(t),this.reject=r(n)}(e)}},function(e,t,n){"use strict";var r,i,a,o=n(10),u=n(112),s=n(111),f=n(29),c=n(2),d=c.process,l=c.setImmediate,h=c.clearImmediate,v=c.MessageChannel,p=c.Dispatch,m=0,y={},b=function(){var e=+this;if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},w=function(e){b.call(e.data)};l&&h||(l=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return y[++m]=function(){u("function"==typeof e?e:Function(e),t)},r(m),m},h=function(e){delete y[e]},"process"==n(15)(d)?r=function(e){d.nextTick(o(b,e,1))}:p&&p.now?r=function(e){p.now(o(b,e,1))}:v?(a=(i=new v).port2,i.port1.onmessage=w,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",w,!1)):r="onreadystatechange"in f("script")?function(e){s.appendChild(f("script")).onreadystatechange=function(){s.removeChild(this),b.call(e)}}:function(e){setTimeout(o(b,e,1),0)}),e.exports={set:l,clear:h}},function(e,t,n){"use strict";var r=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:r)(e)}},function(e,t,n){"use strict";var r=n(24),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){"use strict";e.exports={}},function(e,t,n){"use strict";var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,n){"use strict";var r=n(2),i=n(31),a=n(27),o=n(33)("src"),u=Function.toString,s=(""+u).split("toString");n(7).inspectSource=function(e){return u.call(e)},(e.exports=function(e,t,n,u){var f="function"==typeof n;f&&(a(n,"name")||i(n,"name",t)),e[t]!==n&&(f&&(a(n,o)||i(n,o,e[t]?""+e[t]:s.join(String(t)))),e===r?e[t]=n:u?e[t]?e[t]=n:i(e,t,n):(delete e[t],i(e,t,n)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[o]||u.call(this)})},function(e,t,n){"use strict";var r=n(5),i=n(2).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t,n){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";var r=n(14),i=n(119);e.exports=n(8)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";var r=n(2),i=n(7),a=n(31),o=n(28),u=n(10),s=function e(t,n,s){var f,c,d,l,h=t&e.F,v=t&e.G,p=t&e.P,m=t&e.B,y=v?r:t&e.S?r[n]||(r[n]={}):(r[n]||{}).prototype,b=v?i:i[n]||(i[n]={}),w=b.prototype||(b.prototype={});for(f in v&&(s=n),s)d=((c=!h&&y&&void 0!==y[f])?y:s)[f],l=m&&c?u(d,r):p&&"function"==typeof d?u(Function.call,d):d,y&&o(y,f,d,t&e.U),b[f]!=d&&a(b,f,l),p&&w[f]!=d&&(w[f]=d)};r.core=i,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t,n){"use strict";var r=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+i).toString(36))}},function(e,t,n){"use strict";var r=n(15),i=n(3)("toStringTag"),a="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:a?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},function(e,t,n){"use strict";e.exports=!1},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=o(n(13)),a=o(n(4));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.64001E, mp4a.40.5"';!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=this;(0,i.default)(this),this.codecs=t,this.mediaSource=new window.MediaSource,this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this.updating=!1,this.mediaSource.addEventListener("sourceopen",function(){n.sourceBuffer=n.mediaSource.addSourceBuffer(n.codecs),n.sourceBuffer.addEventListener("error",function(e){n.emit("error",new a.default("mse","",{line:16,handle:"[MSE] constructor sourceopen",msg:e.message}))}),n.sourceBuffer.addEventListener("updateend",function(e){n.emit("updateend");var t=n.queue.shift();t&&n.sourceBuffer.appendBuffer(t)}),n.emit("sourceopen")}),this.mediaSource.addEventListener("sourceclose",function(){n.emit("sourceclose")})}return r(e,[{key:"appendBuffer",value:function(e){var t=this.sourceBuffer;return!1===t.updating&&"open"===this.state?(t.appendBuffer(e),!0):(this.queue.push(e),!1)}},{key:"removeBuffer",value:function(e,t){this.sourceBuffer.remove(e,t)}},{key:"endOfStream",value:function(){"open"===this.state&&this.mediaSource.endOfStream()}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){this.mediaSource.duration=e}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={findBox:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var i=e.subBox.filter(function(e){return e.type===t});i.length?i.forEach(function(e){return n.push(e)}):e.subBox.forEach(function(e){return r.findBox(e,t,n)})}}else n.push(e);return(n=[].concat(n)).length>1?n:n[0]},padStart:function(e,t,n){for(var r=String(n),i=t>>0,a=Math.ceil(i/r.length),o=[],u=String(e);a--;)o.push(r);return o.join("").substring(0,i-u.length)+u},toHex:function(){for(var e=[],t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach(function(t){e.push(r.padStart(Number(t).toString(16),2,0))}),e},sum:function(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach(function(t){e+=t}),e},stscOffset:function(e,t){var n=e.entries.filter(function(e){return e.first_sample<=t&&t<e.first_sample+e.chunk_count*e.samples_per_chunk})[0];if(n){var r=Math.floor((t-n.first_sample)/n.samples_per_chunk),i=n.first_sample+r*n.samples_per_chunk;return{chunk_index:n.first_chunk+r,samples_offset:[i,t]}}var a=e.entries.pop();e.entries.push(a);var o=Math.floor((t-a.first_sample)/a.samples_per_chunk);return{chunk_index:a.first_chunk+o,samples_offset:[a.first_sample+a.samples_per_chunk*o,t]}},seekSampleOffset:function(e,t,n,i,a){var o=r.stscOffset(e,i+1),u=t.entries[o.chunk_index-1]+r.sum.apply(null,n.entries.slice(o.samples_offset[0]-1,o.samples_offset[1]-1))-a;if(void 0===u)throw"result="+u+",stco.length="+t.entries.length+",sum="+r.sum.apply(null,n.entries.slice(0,i));if(u<0)throw"result="+u+",stco.length="+t.entries.length+",sum="+r.sum.apply(null,n.entries.slice(0,i));return u},seekSampleTime:function(e,t,n){var r=void 0,i=void 0,a=0,o=0,u=0;if(e.entry.every(function(e){return i=e.sampleDuration,n<a+e.sampleCount?(r=o+(n-a)*e.sampleDuration,!1):(a+=e.sampleCount,o+=e.sampleCount*i,!0)}),t){var s=0;t.entry.every(function(e){return s+=e.count,!(n<s)||(u=e.offset,!1)})}return r||(r=o+(n-a)*i),{time:r,duration:i,offset:u}},seekOrderSampleByTime:function(e,t,n){var r=0,i=0,a=0,o=void 0;return e.every(function(e,u){return o=e.sampleCount*e.sampleDuration/t,n<=r+o?(i=a+Math.ceil((n-r)*t/e.sampleDuration),r+=Math.ceil((n-r)*t/e.sampleDuration)*e.sampleDuration/t,!1):(r+=o,a+=e.sampleCount,!0)}),{order:i,startTime:r}},seekTrakDuration:function(e,t){var n=0;return r.findBox(e,"stts").entry.forEach(function(e){n+=e.sampleCount*e.sampleDuration}),Number(n/t).toFixed(4)}};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=document.createElement("a"),i=new Blob([n]),a=document.createEvent("MouseEvents");a.initEvent("click",!1,!1),r.download=t,r.href=URL.createObjectURL(i),r.dispatchEvent(a)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(n(17));var a=Math.pow(2,32)-1,o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return i.default.writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new i.default;return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49])),t.buffer}},{key:"moov",value:function(t){var n=new i.default,r=8,a=e.mvhd(t.duration,t.timeScale),o=e.videoTrak(t),u=e.audioTrak(t),s=e.mvex(t.duration,t.timeScale);return[a,o,u,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moov"),a,o,u,s),n.buffer}},{key:"mvhd",value:function(t,n){var r=new i.default;t*=n;var o=Math.floor(t/(a+1)),u=Math.floor(t%(a+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r.write(e.size(8+s.length),e.type("mvhd"),new Uint8Array(s)),r.buffer}},{key:"videoTrak",value:function(t){var n=new i.default,r=8,a=e.tkhd({id:1,duration:t.videoDuration,timescale:t.videoTimeScale,width:t.width,height:t.height,type:"video"}),o=e.mdia({type:"video",timescale:t.videoTimeScale,duration:t.videoDuration,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height});return[a,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),a,o),n.buffer}},{key:"audioTrak",value:function(t){var n=new i.default,r=8,a=e.tkhd({id:2,duration:t.audioDuration,timescale:t.audioTimeScale,width:0,height:0,type:"audio"}),o=e.mdia({type:"audio",timescale:t.audioTimeScale,duration:t.audioDuration,channelCount:t.channelCount,samplerate:t.sampleRate,audioConfig:t.audioConfig});return[a,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("trak"),a,o),n.buffer}},{key:"tkhd",value:function(t){var n=new i.default,r=t.id,o=t.duration*t.timeScale,u=t.width,s=t.height,f=t.type,c=Math.floor(o/(a+1)),d=Math.floor(o%(a+1)),l=new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d,0,0,0,0,0,0,0,0,0,0,0,"video"===f?1:0,"audio"===f?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,u>>8&255,255&u,0,0,s>>8&255,255&s,0,0]);return n.write(e.size(8+l.byteLength),e.type("tkhd"),l),n.buffer}},{key:"edts",value:function(t){var n=new i.default,r=t.duration,a=t.mediaTime;return n.write(e.size(36),e.type("edts")),n.write(e.size(28),e.type("elst")),n.write(new Uint8Array([0,0,0,1,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,1])),n.buffer}},{key:"mdia",value:function(t){var n=new i.default,r=8,a=e.mdhd(t.timescale),o=e.hdlr(t.type),u=e.minf(t);return[a,o,u].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("mdia"),a,o,u),n.buffer}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=new i.default;n*=t;var o=Math.floor(n/(a+1)),u=Math.floor(n%(a+1)),s=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,o>>24,o>>16&255,o>>8&255,255&o,u>>24,u>>16&255,u>>8&255,255&u,85,196,0,0]);return r.write(e.size(12+s.byteLength),e.type("mdhd"),e.extension(1,0),s),r.buffer}},{key:"hdlr",value:function(t){var n=new i.default,r=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(r.splice.apply(r,[8,4].concat([115,111,117,110])),r.splice.apply(r,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),n.write(e.size(8+r.length),e.type("hdlr"),new Uint8Array(r)),n.buffer}},{key:"minf",value:function(t){var n=new i.default,r=8,a="video"===t.type?e.vmhd():e.smhd(),o=e.dinf(),u=e.stbl(t);return[a,o,u].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("minf"),a,o,u),n.buffer}},{key:"vmhd",value:function(){var t=new i.default;return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new i.default;return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new i.default;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){var n=new i.default,r=8,a=e.stsd(t),o=e.stts(),u=e.stsc(),s=e.stsz(),f=e.stco();return[a,o,u,s,f].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("stbl"),a,o,u,s,f),n.buffer}},{key:"stsd",value:function(t){var n=new i.default,r=void 0;return r="audio"===t.type?e.mp4a(t):e.avc1(t),n.write(e.size(16+r.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),r),n.buffer}},{key:"mp4a",value:function(t){var n=new i.default,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),a=e.esds(t.audioConfig);return n.write(e.size(8+r.byteLength+a.byteLength),e.type("mp4a"),r,a),n.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],n=t.length,r=new i.default,a=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(t).concat([6,1,2]));return r.write(e.size(8+a.byteLength),e.type("esds"),a),r.buffer}},{key:"avc1",value:function(t){var n=new i.default,r=t.sps,a=t.pps,o=t.width,u=t.height,s=t.pixelRatio[0],f=t.pixelRatio[1],c=new Uint8Array([1,r[1],r[2],r[3],255,225].concat([r.length>>>8&255,255&r.length]).concat(r).concat(1).concat([a.length>>>8&255,255&a.length]).concat(a)),d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,f>>24,f>>16&255,f>>8&255,255&f]);return n.write(e.size(40+d.byteLength+c.byteLength+l.byteLength),e.type("avc1"),d,e.size(8+c.byteLength),e.type("avcC"),c,e.size(20),e.type("btrt"),l,e.size(16),e.type("pasp"),h),n.buffer}},{key:"stts",value:function(){var t=new i.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),n),t.buffer}},{key:"stsc",value:function(){var t=new i.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),n),t.buffer}},{key:"stco",value:function(){var t=new i.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),n),t.buffer}},{key:"stsz",value:function(){var t=new i.default,n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),n),t.buffer}},{key:"mvex",value:function(t,n){var r=new i.default,a=i.default.writeUint32(t*n);return r.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),a,e.trex(1),e.trex(2)),r.buffer}},{key:"trex",value:function(t){var n=new i.default,r=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return n.write(e.size(8+r.byteLength),e.type("trex"),r),n.buffer}},{key:"moof",value:function(t){var n=new i.default,r=8,a=e.mfhd(),o=e.traf(t);return[a,o].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("moof"),a,o),n.buffer}},{key:"mfhd",value:function(){var t=new i.default,n=i.default.writeUint32(e.sequence);return e.sequence+=1,t.write(e.size(16),e.type("mfhd"),e.extension(0,0),n),t.buffer}},{key:"traf",value:function(t){var n=new i.default,r=8,a=e.tfhd(t.id),o=e.tfdt(t.time),u=e.sdtp(t),s=e.trun(t,u.byteLength);return[a,o,u,s].forEach(function(e){r+=e.byteLength}),n.write(e.size(r),e.type("traf"),a,o,u,s),n.buffer}},{key:"tfhd",value:function(t){var n=new i.default,r=i.default.writeUint32(t);return n.write(e.size(16),e.type("tfhd"),e.extension(0,0),r),n.buffer}},{key:"tfdt",value:function(t){var n=new i.default,r=Math.floor(t/(a+1)),o=Math.floor(t%(a+1));return n.write(e.size(20),e.type("tfdt"),e.extension(1,0),i.default.writeUint32(r),i.default.writeUint32(o)),n.buffer}},{key:"trun",value:function(t,n){var r=t.id,a=1===r?16:12,o=new i.default,u=i.default.writeUint32(t.samples.length),s=i.default.writeUint32(96+a*t.samples.length+n);return o.write(e.size(20+a*t.samples.length),e.type("trun"),e.extension(0,t.flags),u,s),t.samples.forEach(function(e,t){o.write(i.default.writeUint32(e.duration)),o.write(i.default.writeUint32(e.size)),1===r?(o.write(i.default.writeUint32(e.key?33554432:16842752)),o.write(i.default.writeUint32(e.offset))):o.write(i.default.writeUint32(16777216))}),o.buffer}},{key:"sdtp",value:function(t){var n=new i.default;return n.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach(function(e){n.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))}),n.buffer}},{key:"mdat",value:function(t){var n=new i.default,r=8;return t.samples.forEach(function(e){r+=e.size}),n.write(e.size(r),e.type("mdat")),t.samples.forEach(function(e){n.write(e.buffer)}),n.buffer}}]),e}();o.sequence=1,t.default=o,e.exports=t.default},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.avc1=function(){var e=new i.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var t=0;t<31;t++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var n=new r.default;n.readHeader(e),this.subBox.push(n),n.readBody(e)}delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.avcC=function(){var e=new i.default(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var n=[],r=0;r<t;r++)n.push(Number(e.readUint8()).toString(16));this.ppsCount=e.readUint8();var a=e.readUint16();this.ppsLength=a;for(var o=[],u=0;u<a;u++)o.push(Number(e.readUint8()).toString(16));this.pps=o,this.sequence=n;for(var s=[],f=e.dataview.byteLength;e.position<f;)s.push(e.readUint8());this.last=s,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.btrt=function(){var e=new i.default(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.co64=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.ctts=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var n=0,r=this.entryCount;n<r;n++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.dref=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var n=0;n<t;n++){var a=new r.default;this.subBox.push(a),a.read(e)}delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.elst=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);var t=[],n=e.readUint32();this.entries=t;for(var r=0;r<n;r++){var a={};t.push(a),1===this.version?(a.segment_duration=e.readUint64(),a.media_time=e.readUint64()):(a.segment_duration=e.readUint32(),a.media_time=e.readInt32()),a.media_rate_integer=e.readInt16(),a.media_rate_fraction=e.readInt16()}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.esds=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);var t=r.default.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.ftyp=function(){var e=new i.default(this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],n=0,r=Math.floor((e.buffer.byteLength-8)/4);n<r;n++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.hdlr=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.iods=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3);for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";(function(e){return e&&e.__esModule?e:{default:e}})(n(0)).default.mdat=function(){delete this.subBox}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1)),a=o(n(11));function o(e){return e&&e.__esModule?e:{default:e}}r.default.mdhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.mp4a=function(){var e=new i.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new r.default;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.MP4DecConfigDescrTag=function(e){var t=new r.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=i.default.readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(r.default.MP4DecSpecificDescrTag(e)),t}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0));r.default.MP4DecSpecificDescrTag=function(e){var t=new r.default,n=void 0,i=void 0;t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),i=(n=e.readUint8()+5)-5):(i=n,n+=2),t.size=n;for(var a=[],o=0;o<i;o++)a.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=a,delete t.subBox,t}},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0));r.default.MP4ESDescrTag=function(e){var t=new r.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(r.default.MP4DecConfigDescrTag(e)),t.subBox.push(r.default.SLConfigDescriptor(e)),t}},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1)),a=o(n(11));function o(e){return e&&e.__esModule?e:{default:e}}r.default.mvhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),i.default.readByte(e.dataview,8),i.default.readByte(e.dataview,2);for(var t=[],n=0;n<9;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,i.default.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data}},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.pasp=function(){var e=new i.default(this.data);this.content=e.buffer.slice(0,this.size-8),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=function(e){return e&&e.__esModule?e:{default:e}}(n(0));r.default.SLConfigDescriptor=function(e){var t=new r.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.SL=e.readUint8(),delete t.subBox,t}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.smhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.stco=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.stsc=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var a,o,u=0,s=this.count;u<s-1;u++)a=t[u],o=t[u-1],a.chunk_count=t[u+1].first_chunk-a.first_chunk,a.first_sample=0===u?1:o.first_sample+o.chunk_count*o.samples_per_chunk;if(1===this.count){var f=t[0];f.first_sample=1,f.chunk_count=0}else if(this.count>1){var c=t[this.count-1],d=t[this.count-2];c.first_sample=d.first_sample+d.chunk_count*d.samples_per_chunk,c.chunk_count=0}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.stsd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new r.default;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.stss=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.stsz=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,r=this.count;n<r;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.stts=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],n=0,r=this.count;n<r;n++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict"},function(e,t,n){"use strict";var r=o(n(0)),i=o(n(1)),a=o(n(11));function o(e){return e&&e.__esModule?e:{default:e}}r.default.tkhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=i.default.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],n=0;n<9;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null}},function(e,t,n){"use strict"},function(e,t,n){"use strict"},function(e,t,n){"use strict";(function(e){return e&&e.__esModule?e:{default:e}})(n(0)).default.udta=function(){delete this.subBox}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default["url "]=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var r=a(n(0)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}r.default.vmhd=function(){var e=new i.default(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=!0,o=!1,u=void 0;try{for(var s,f=r[Symbol.iterator]();!(a=(s=f.next()).done);a=!0){t+=s.value.length}}catch(e){o=!0,u=e}finally{try{!a&&f.return&&f.return()}finally{if(o)throw u}}var c=new e(t),d=0,l=!0,h=!1,v=void 0;try{for(var p,m=r[Symbol.iterator]();!(l=(p=m.next()).done);l=!0){var y=p.value;c.set(y,d),d+=y.length}}catch(e){h=!0,v=e}finally{try{!l&&m.return&&m.return()}finally{if(h)throw v}}return c}},function(e){e.exports={name:"xgplayer-mp4",version:"1.0.5",description:"xgplayer plugin for mp4 transform to fmp4",main:"./dist/index.js",scripts:{dev:"webpack-dev-server --open",prepare:"npm run build",build:"webpack --progress --display-chunks -p",watch:"webpack --progress --display-chunks -p --watch"},repository:{type:"git",url:"git@github.com:bytedance/xgplayer.git"},babel:{presets:["es2015"],plugins:["add-module-exports","babel-plugin-bulk-import"]},keywords:["mp4","fmp4","player","video"],author:"yinguohui@bytedance.com",license:"MIT",dependencies:{"babel-loader":"^7.1.4","babel-plugin-add-module-exports":"^0.2.1","babel-plugin-bulk-import":"^1.0.2","babel-preset-es2015":"^6.24.1","concat-typed-array":"^1.0.2",deepmerge:"^2.0.1","event-emitter":"^0.3.5","json-loader":"^0.5.7",webpack:"^4.11.0"},peerDependency:{xgplayer:"^0.1.0"},devDependencies:{"babel-core":"^6.26.3","html-webpack-plugin":"^3.2.0","webpack-cli":"^3.0.8","webpack-dev-server":"^3.1.4"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=V(n(0)),i=V(n(18)),a=V(n(1)),o=V(n(80)),u=V(n(79)),s=V(n(78)),f=V(n(77)),c=V(n(76)),d=V(n(75)),l=V(n(74)),h=V(n(73)),v=V(n(72)),p=V(n(71)),m=V(n(70)),y=V(n(69)),b=V(n(68)),w=V(n(67)),g=V(n(66)),_=V(n(65)),x=V(n(64)),U=V(n(63)),k=V(n(62)),S=V(n(61)),B=V(n(60)),M=V(n(59)),T=V(n(58)),O=V(n(57)),j=V(n(56)),E=V(n(55)),z=V(n(54)),C=V(n(53)),P=V(n(52)),A=V(n(51)),D=V(n(50)),L=V(n(49)),R=V(n(48)),F=V(n(47)),I=V(n(46)),N=V(n(45)),q=V(n(44)),K=V(n(43)),H=V(n(42)),G=V(n(41));function V(e){return e&&e.__esModule?e:{default:e}}var W={};function X(e,t,n){var r=e;t.map(function(e,i){r[e]=i==t.length-1?n:r[e]||{},r=r[e]})}X(W,["box\\avc1"],V(n(40)).default),X(W,["box\\avcC"],G.default),X(W,["box\\btrt"],H.default),X(W,["box\\co64"],K.default),X(W,["box\\ctts"],q.default),X(W,["box\\dref"],N.default),X(W,["box\\elst"],I.default),X(W,["box\\esds"],F.default),X(W,["box\\ftyp"],R.default),X(W,["box\\hdlr"],L.default),X(W,["box\\hmhd"],D.default),X(W,["box\\iods"],A.default),X(W,["box\\mdat"],P.default),X(W,["box\\mdhd"],C.default),X(W,["box\\mfhd"],z.default),X(W,["box\\mp4a"],E.default),X(W,["box\\MP4DecConfigDescrTag"],j.default),X(W,["box\\MP4DecSpecificDescrTag"],O.default),X(W,["box\\MP4ESDescrTag"],T.default),X(W,["box\\mvhd"],M.default),X(W,["box\\nmhd"],B.default),X(W,["box\\pasp"],S.default),X(W,["box\\sbgp"],k.default),X(W,["box\\sdtp"],U.default),X(W,["box\\SLConfigDescriptor"],x.default),X(W,["box\\smhd"],_.default),X(W,["box\\stco"],g.default),X(W,["box\\stsc"],w.default),X(W,["box\\stsd"],b.default),X(W,["box\\stsh"],y.default),X(W,["box\\stss"],m.default),X(W,["box\\stsz"],p.default),X(W,["box\\stts"],v.default),X(W,["box\\stz2"],h.default),X(W,["box\\tfhd"],l.default),X(W,["box\\tkhd"],d.default),X(W,["box\\traf"],c.default),X(W,["box\\trun"],f.default),X(W,["box\\udta"],s.default),X(W,["box\\url"],u.default),X(W,["box\\vmhd"],o.default);t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;this.buffer?(0,i.default)(Uint8Array,this.buffer,t):this.buffer=t;var n=t.byteLength;t.position=0;for(var o=new a.default(t);n-o.position>=8;){var u=new r.default;if(u.readHeader(o),u.size-8<=n-o.position)u.readBody(o),this.boxes.push(u);else{if("mdat"!==u.type){this.nextBox=u,o.position-=8;break}u.readBody(o),this.boxes.push(u)}}this.buffer=new Uint8Array(this.buffer.slice(o.position))},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e){return function(e){return!!e&&"object"===(void 0===e?"undefined":r(e))}(e)&&!function(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||function(e){return e.$$typeof===a}(e)}(e)};var a="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function o(e,t){return!1!==t.clone&&t.isMergeableObject(e)?s(function(e){return Array.isArray(e)?[]:{}}(e),e,t):e}function u(e,t,n){return e.concat(t).map(function(e){return o(e,n)})}function s(e,t,n){(n=n||{}).arrayMerge=n.arrayMerge||u,n.isMergeableObject=n.isMergeableObject||i;var r=Array.isArray(t);return r===Array.isArray(e)?r?n.arrayMerge(e,t,n):function(e,t,n){var r={};return n.isMergeableObject(e)&&Object.keys(e).forEach(function(t){r[t]=o(e[t],n)}),Object.keys(t).forEach(function(i){n.isMergeableObject(t[i])&&e[i]?r[i]=s(e[i],t[i],n):r[i]=o(t[i],n)}),r}(e,t,n):o(t,n)}s.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(e,n){return s(e,n,t)},{})};var f=s;t.default=f,e.exports=t.default},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";var r=String.prototype.indexOf;e.exports=function(e){return r.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";var r="razdwatrzy";e.exports=function(){return"function"==typeof r.contains&&(!0===r.contains("dwa")&&!1===r.contains("foo"))}},function(e,t,n){"use strict";e.exports=n(87)()?String.prototype.contains:n(86)},function(e,t,n){"use strict";e.exports=function(e){return"function"==typeof e}},function(e,t,n){"use strict";var r=n(12),i=Array.prototype.forEach,a=Object.create;e.exports=function(e){var t=a(null);return i.call(arguments,function(e){r(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t}},function(e,t,n){"use strict";var r=n(12);e.exports=function(e){if(!r(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var r=n(12),i=Object.keys;e.exports=function(e){return i(r(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";e.exports=n(94)()?Object.keys:n(93)},function(e,t,n){"use strict";var r=n(95),i=n(91),a=Math.max;e.exports=function(e,t){var n,o,u,s=a(arguments.length,2);for(e=Object(i(e)),u=function(r){try{e[r]=t[r]}catch(e){n||(n=e)}},o=1;o<s;++o)t=arguments[o],r(t).forEach(u);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";e.exports=n(97)()?Object.assign:n(96)},function(e,t,n){"use strict";var r=n(98),i=n(90),a=n(89),o=n(88);(e.exports=function(e,t){var n,a,u,s,f;return arguments.length<2||"string"!=typeof e?(s=t,t=e,e=null):s=arguments[2],null==e?(n=u=!0,a=!1):(n=o.call(e,"c"),a=o.call(e,"e"),u=o.call(e,"w")),f={value:t,configurable:n,enumerable:a,writable:u},s?r(i(s),f):f}).gs=function(e,t,n){var u,s,f,c;return"string"!=typeof e?(f=n,n=t,t=e,e=null):f=arguments[3],null==t?t=void 0:a(t)?null==n?n=void 0:a(n)||(f=n,n=void 0):(f=t,t=n=void 0),null==e?(u=!0,s=!1):(u=o.call(e,"c"),s=o.call(e,"e")),c={get:t,set:n,configurable:u,enumerable:s},f?r(i(f),c):c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=l(n(13)),a=l(n(84)),o=l(n(83)),u=l(n(17)),s=l(n(39)),f=l(n(16)),c=(l(n(38)),l(n(37))),d=l(n(4));function l(e){return e&&e.__esModule?e:{default:e}}var h=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.pow(25,4);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(0,i.default)(this),this.url=t,this.CHUNK_SIZE=n,this.init(t),this.once("moovReady",this.moovParse.bind(this)),this.cache=new u.default,this.bufferCache=new Set,this.timeRage=[],this.canDownload=!0}return r(e,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE,r=this;return new Promise(function(i,a){new f.default(e.url,[t,n],i).once("error",function(e){r.emit("error",e)})})}},{key:"moovParse",value:function(){var e=this,t=this,n=this.moovBox,r=c.default.findBox(n,"mvhd"),i=void 0,o=void 0,u=void 0,s=void 0,f=void 0,l=void 0,h=void 0,v=void 0,p=void 0,m=void 0,y=void 0,b=void 0,w=void 0,g=void 0;c.default.findBox(n,"trak").forEach(function(e){var n=c.default.findBox(e,"hdlr"),r=c.default.findBox(e,"mdhd");if(n&&r){var a=c.default.findBox(e,"stsd").subBox[0];if("vide"===n.handleType){var _=c.default.findBox(e,"avcC"),x=c.default.findBox(e,"avc1");i=e,f=r.timescale,_?(u=a.type+"."+c.default.toHex(_.profile,_.profileCompatibility,_.AVCLevelIndication).join(""),h=_.sequence&&_.sequence.map(function(e){return Number("0x"+e)}),v=_.pps&&_.pps.map(function(e){return Number("0x"+e)}),p=_.profile):u=""+a.type,x&&(m=x.width,y=x.height)}if("soun"===n.handleType){o=e;var U=c.default.findBox(e,"esds"),k=c.default.findBox(e,"mp4a"),S=c.default.findBox(e,5);l=r.timescale,s=U?a.type+"."+c.default.toHex(U.subBox[0].subBox[0].typeID)+"."+U.subBox[0].subBox[0].subBox[0].type:""+a.type,S&&S.EScode&&(g=S.EScode.map(function(e){return Number("0x"+e)})),k&&(b=k.channelCount,w=k.sampleRate)}}else t.emit("error",new d.default("parse","",{line:72,handle:"[MP4] moovParse",url:t.url}))}),this.videoTrak=(0,a.default)({},i),this.audioTrak=(0,a.default)({},o);var _=this._boxes.find(function(e){return"mdat"===e.type}),x=c.default.seekTrakDuration(i,f),U=c.default.seekTrakDuration(o,l);this.mdatStart=_.start;var k=this.videoKeyFrames,S=k.length-1;k.forEach(function(t,n){n<S?e.timeRage.push([t.time.time/f,k[n+1].time.time/f]):e.timeRage.push([t.time.time/f,-1])}),this.meta={videoCodec:u,audioCodec:s,createTime:r.createTime,modifyTime:r.modifyTime,duration:r.duration/r.timeScale,timeScale:r.timeScale,videoDuration:x,videoTimeScale:f,audioDuration:U,audioTimeScale:l,endTime:Math.min(x,U),sps:h,pps:v,width:m,height:y,profile:p,pixelRatio:[1,1],channelCount:b,sampleRate:w,audioConfig:g}}},{key:"init",value:function(){var e=this;e.getData().then(function(t){var n=void 0,r=0,i=void 0,a=void 0;try{n=new o.default(t)}catch(t){return e.emit("error",t.type?t:new d.default("parse","",{line:176,handle:"[MP4] init",msg:t.message})),!1}if(e._boxes=a=n.boxes,a.every(function(t){return r+=t.size,"moov"!==t.type||(i=t,e.moovBox=i,e.emit("moovReady",i),!1)}),!i){var u=n.nextBox;u?"moov"===u.type?e.getData(r,r+u.size+28).then(function(t){var n=new o.default(t);e._boxes=e._boxes.concat(n.boxes),(i=n.boxes.filter(function(e){return"moov"===e.type})).length?(e.moovBox=i[0],e.emit("moovReady",i)):e.emit("error",new d.default("parse","",{line:203,handle:"[MP4] init",msg:"not find moov box"}))}):e.emit("error",new d.default("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"})):e.getData(r,"").then(function(t){var n=new o.default(t);n?(e._boxes=e._boxes.concat(n.boxes),n.boxes.every(function(t){return"moov"!==t.type||(i=t,e.moovBox=i,e.emit("moovReady",i),!1)})):e.emit("error",new d.default("parse","",{line:225,handle:"[MP4] init",msg:"not find moov box"}))})}}).catch(function(){e.emit("error",new d.default("network","",{line:231,handle:"[MP4] getData",msg:"getData failed"}))})}},{key:"getSamplesByOrders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments[1],n=arguments[2],r="video"===e?this.videoTrak:this.audioTrak,i=c.default.findBox(r,"stsc"),a=c.default.findBox(r,"stsz"),o=c.default.findBox(r,"stts"),u=c.default.findBox(r,"stco"),s=c.default.findBox(r,"ctts"),f=this.mdatStart,d=[];if(n=void 0!==n?n:a.entries.length,t instanceof Array)t.forEach(function(e,t){d.push({idx:e,size:a.entries[e],time:c.default.seekSampleTime(o,s,e),offset:c.default.seekSampleOffset(i,u,a,e,f)})});else if(0!==n)for(var l=t;l<n;l++)d.push({idx:l,size:a.entries[l],time:c.default.seekSampleTime(o,s,l),offset:c.default.seekSampleOffset(i,u,a,l,f)});else d={idx:t,size:a.entries[t],time:c.default.seekSampleTime(o,s,t),offset:c.default.seekSampleOffset(i,u,a,t,f)};return d}},{key:"packMeta",value:function(){if(this.meta){var e=new u.default;return e.write(s.default.ftyp()),e.write(s.default.moov(this.meta)),this.cache.write(e.buffer),e.buffer}}},{key:"seek",value:function(e){var t=e*this.meta.videoTimeScale,n=void 0,r=this.videoKeyFrames,i=this.audioKeyFrames;return r.every(function(e,i){var a=e.time.time,o=r[i+1]?r[i+1].time.time:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(n=i,!1)}),i.every(function(e,r){var a=e.startTime,o=i[r+1]?i[r+1].startTime:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(n=Math.min(r,n),!1)}),this.bufferCache.has(n)?Promise.resolve(null):this.loadFragment(n)}},{key:"loadFragment",value:function(e){var t,n=void 0,r=this.videoKeyFrames[e],i=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);if(t=Math.min(r.offset,i.offset),e<this.videoKeyFrames.length-1){var a=this.videoKeyFrames[e+1],o=this.getSamplesByOrders("audio",this.audioKeyFrames[e+1].order,0);n=Math.max(a.offset,o.offset)}var u=this;return window.isNaN(t)||void 0!==n&&window.isNaN(n)?(u.emit("error",new d.default("parse","",{line:366,handle:"[MP4] loadFragment",url:u.url})),!1):this.bufferCache.has(e)?Promise.resolve(null):this.getData(t+u.mdatStart,n?u.mdatStart+n:"").then(function(n){return u.createFragment(new Uint8Array(n),t,e)})}},{key:"addFragment",value:function(e){var t=new u.default;return t.write(s.default.moof(e)),t.write(s.default.mdat(e)),this.cache.write(t.buffer),t.buffer}},{key:"createFragment",value:function(e,t,n){var r=[];this.bufferCache.add(n);var i=this.videoKeyFrames.map(function(e){return e.idx}),a=this.getSamplesByOrders("video",i[n],i[n+1]),o=a.map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});r.push(this.addFragment({id:1,time:a[0].time.time,firstFlags:33554432,flags:3841,samples:o}));var u=this.getSamplesByOrders("audio",this.audioKeyFrames[n].order,this.audioKeyFrames[n+1]?this.audioKeyFrames[n+1].order:void 0),s=u.map(function(n,r){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===r}});r.push(this.addFragment({id:2,time:u[0].time.time,firstFlags:0,flags:1793,samples:s}));var f=0;r.every(function(e){return f+=e.byteLength,!0});var c=new Uint8Array(f),d=0;return r.every(function(e){return c.set(e,d),d+=e.byteLength,!0}),Promise.resolve(c)}},{key:"download",value:function(){}},{key:"videoKeyFrames",get:function(){if(this._videoFrames)return this._videoFrames;var e=this.videoTrak,t=c.default.findBox(e,"stss"),n=this.getSamplesByOrders("video",t.entries.map(function(e){return e-1}));return this._videoFrames=n,n}},{key:"audioKeyFrames",get:function(){if(this._audioFrames)return this._audioFrames;var e,t=c.default.findBox(this.videoTrak,"mdhd").timescale,n=c.default.findBox(this.audioTrak,"mdhd").timescale,r=c.default.findBox(this.audioTrak,"stts").entry;return e=this.videoKeyFrames.map(function(e){return c.default.seekOrderSampleByTime(r,n,e.time.time/t)}),this._audioFrames=e,this._audioFrames}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";var r=n(24),i=n(20);e.exports=function(e){var t=String(i(this)),n="",a=r(e);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(n+=t);return n}},function(e,t,n){"use strict";var r=n(25),i=n(101),a=n(20);e.exports=function(e,t,n,o){var u=String(a(e)),s=u.length,f=void 0===n?" ":String(n),c=r(t);if(c<=s||""==f)return u;var d=c-s,l=i.call(f,Math.ceil(d/f.length));return l.length>d&&(l=l.slice(0,d)),o?l+u:u+l}},function(e,t,n){"use strict";var r=n(32),i=n(102),a=n(21);r(r.P+r.F*/Version\/10\.\d+(\.\d+)? Safari\//.test(a),"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},function(e,t,n){"use strict";var r=n(3)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t,n){"use strict";var r=n(2),i=n(14),a=n(8),o=n(3)("species");e.exports=function(e){var t=r[e];a&&t&&!t[o]&&i.f(t,o,{configurable:!0,get:function(){return this}})}},function(e,t,n){"use strict";var r=n(14).f,i=n(27),a=n(3)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){"use strict";var r=n(28);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},function(e,t,n){"use strict";var r=n(6),i=n(5),a=n(22);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},function(e,t,n){"use strict";e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},function(e,t,n){"use strict";var r=n(2),i=n(23).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,u=r.Promise,s="process"==n(15)(o);e.exports=function(){var e,t,n,f=function(){var r,i;for(s&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(s)n=function(){o.nextTick(f)};else if(!a||r.navigator&&r.navigator.standalone)if(u&&u.resolve){var c=u.resolve(void 0);n=function(){c.then(f)}}else n=function(){i.call(r,f)};else{var d=!0,l=document.createTextNode("");new a(f).observe(l,{characterData:!0}),n=function(){l.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(2).document;e.exports=r&&r.documentElement},function(e,t,n){"use strict";e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){"use strict";var r=n(6),i=n(9),a=n(3)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||void 0==(n=r(o)[a])?t:i(n)}},function(e,t,n){"use strict";var r=n(34),i=n(3)("iterator"),a=n(26);e.exports=n(7).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){"use strict";var r=n(26),i=n(3)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){"use strict";var r=n(6);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){"use strict";var r=n(10),i=n(116),a=n(115),o=n(6),u=n(25),s=n(114),f={},c={},d=e.exports=function(e,t,n,d,l){var h,v,p,m,y=l?function(){return e}:s(e),b=r(n,d,t?2:1),w=0;if("function"!=typeof y)throw TypeError(e+" is not iterable!");if(a(y)){for(h=u(e.length);h>w;w++)if((m=t?b(o(v=e[w])[0],v[1]):b(e[w]))===f||m===c)return m}else for(p=y.call(e);!(v=p.next()).done;)if((m=i(p,b,v.value,t))===f||m===c)return m};d.BREAK=f,d.RETURN=c},function(e,t,n){"use strict";e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){"use strict";var r=n(5);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){"use strict";e.exports=!n(8)&&!n(30)(function(){return 7!=Object.defineProperty(n(29)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){"use strict";var r=n(7),i=n(2),a=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return a[e]||(a[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(35)?"pure":"global",copyright:"© 2018 Denis Pushkarev (zloirock.ru)"})},function(e,t,n){"use strict";var r,i,a,o,u=n(35),s=n(2),f=n(10),c=n(34),d=n(32),l=n(5),h=n(9),v=n(118),p=n(117),m=n(113),y=n(23).set,b=n(110)(),w=n(22),g=n(109),_=n(21),x=n(108),U=s.TypeError,k=s.process,S=k&&k.versions,B=S&&S.v8||"",M=s.Promise,T="process"==c(k),O=function(){},j=i=w.f,E=!!function(){try{var e=M.resolve(1),t=(e.constructor={})[n(3)("species")]=function(e){e(O,O)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(O)instanceof t&&0!==B.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(e){}}(),z=function(e){var t;return!(!l(e)||"function"!=typeof(t=e.then))&&t},C=function(e,t){if(!e._n){e._n=!0;var n=e._c;b(function(){for(var r=e._v,i=1==e._s,a=0,o=function(t){var n,a,o,u=i?t.ok:t.fail,s=t.resolve,f=t.reject,c=t.domain;try{u?(i||(2==e._h&&D(e),e._h=1),!0===u?n=r:(c&&c.enter(),n=u(r),c&&(c.exit(),o=!0)),n===t.promise?f(U("Promise-chain cycle")):(a=z(n))?a.call(n,s,f):s(n)):f(r)}catch(e){c&&!o&&c.exit(),f(e)}};n.length>a;)o(n[a++]);e._c=[],e._n=!1,t&&!e._h&&P(e)})}},P=function(e){y.call(s,function(){var t,n,r,i=e._v,a=A(e);if(a&&(t=g(function(){T?k.emit("unhandledRejection",i,e):(n=s.onunhandledrejection)?n({promise:e,reason:i}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=T||A(e)?2:1),e._a=void 0,a&&t.e)throw t.v})},A=function(e){return 1!==e._h&&0===(e._a||e._c).length},D=function(e){y.call(s,function(){var t;T?k.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({promise:e,reason:e._v})})},L=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),C(t,!0))},R=function e(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw U("Promise can't be resolved itself");(n=z(t))?b(function(){var i={_w:r,_d:!1};try{n.call(t,f(e,i,1),f(L,i,1))}catch(e){L.call(i,e)}}):(r._v=t,r._s=1,C(r,!1))}catch(e){L.call({_w:r,_d:!1},e)}}};E||(M=function(e){v(this,M,"Promise","_h"),h(e),r.call(this);try{e(f(R,this,1),f(L,this,1))}catch(e){L.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(107)(M.prototype,{then:function(e,t){var n=j(m(this,M));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?k.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&C(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),a=function(){var e=new r;this.promise=e,this.resolve=f(R,e,1),this.reject=f(L,e,1)},w.f=j=function(e){return e===M||e===o?new a(e):i(e)}),d(d.G+d.W+d.F*!E,{Promise:M}),n(106)(M,"Promise"),n(105)("Promise"),o=n(7).Promise,d(d.S+d.F*!E,"Promise",{reject:function(e){var t=j(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(u||!E),"Promise",{resolve:function(e){return x(u&&this===o?M:this,e)}}),d(d.S+d.F*!(E&&n(104)(function(e){M.all(e).catch(O)})),"Promise",{all:function(e){var t=this,n=j(t),r=n.resolve,i=n.reject,a=g(function(){var n=[],a=0,o=1;p(e,!1,function(e){var u=a++,s=!1;n.push(void 0),o++,t.resolve(e).then(function(e){s||(s=!0,n[u]=e,--o||r(n))},i)}),--o||r(n)});return a.e&&i(a.v),n.promise},race:function(e){var t=this,n=j(t),r=n.reject,i=g(function(){p(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}})},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n(123),n(103);var i=s(n(19)),a=s(n(100)),o=s(n(36)),u=s(n(16));function s(e){return e&&e.__esModule?e:{default:e}}var f=function(e,t){t.vid=e.config.vid,t.url=e.src,t.errd&&"object"===r(t.errd)&&e.mp4&&(t.errd.url=e.mp4.url,t.url=e.mp4.url,e.mp4.canDownload=!1),e.emit("DATA_REPORT",t),"network"===t.errt&&e.config._backupURL?e.src=e.config._backupURL:e.src=e.config._mainURL,e.switchURL=null,e._replay=null};i.default.install("mp4player",function(){var e=this,t=i.default.sniffer,n=i.default.util,r=i.default.Errors,s=void 0,c=void 0,d=e.config.preloadTime||15,l=void 0,h=e.config.url,v=e.config.pluginRule||function(){return!0};if(h){"String"===n.typeOf(h)?s=h:"Array"===n.typeOf(h)&&h.length&&(s=h[0].src,c=h[1].src),e.config._mainURL=s,e.config._backupURL=c;var p=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.currentTime;e.timer&&clearTimeout(e.timer),r=Math.max(r,e.currentTime),e.timer=setTimeout(function(){e.mp4.seek(r+.1*n).then(function(t){if(t){var n=e.mse;n.updating=!0,n.appendBuffer(t),n.once("updateend",function(){n.updating=!1})}},function(){n<10&&setTimeout(function(){t(n+1)},2e3)})},50)},m=function(t){var n=new a.default(t),r=void 0;return new Promise(function(t,i){n.once("moovReady",function(){(r=new o.default).on("sourceopen",function(){r.appendBuffer(n.packMeta()),r.once("updateend",p.bind(e))}),r.on("error",function(e){i(e)}),t([n,r])}),n.on("error",function(e){i(e)})})};if(["chrome","firfox","safari"].some(function(e){return e===t.browser})&&o.default.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')){var y=e.start;if(!v.call(e))return!1;e.start=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;m(n).then(function(t){var n=t[0],r=t[1];y.call(e,r.url),e.mp4=n,e.mse=r,n.on("error",function(t){f(e,t)})},function(t){y.call(e,n),f(e,t)}),e.download=function(){e.mp4.download()},e.once("canplay",function(){if("safari"===t.browser&&e.buffered){var n=e.buffered.start(0);e.currentTime=n+.1}})},e.switchURL=function(n){var r=new a.default(n),i=e.mp4;r.on("moovReady",function(){i.timeRage;var n=e.currentTime,a=i.timeRage.find(function(e){return e[0]-n>2})[0],o=e.getBufferedRange()[1];o-a>0&&"safari"!==t.browser&&e.mse.removeBuffer(a,o),e.mp4=r,e.mse.appendBuffer(r.packMeta())}),r.on("error",function(t){f(e,t)})},e.on("timeupdate",function(){var t=e.mse,n=e.mp4;if(t&&!t.updating&&n.canDownload){var r=n.timeRage,i=e.getBufferedRange(),a=e.currentTime+d;if(i[1]-a>0)return;r.every(function(e,t){var r=(e[0]+e[1])/2;return 0===i[1]?(p(5),!1):!(r>i[1]&&!n.bufferCache.has(t))||void p(0,r)}),function(e,t){if(t.meta.endTime-e.currentTime<2){var n=e.getBufferedRange();e.currentTime-n[1]<.1&&e.mse.endOfStream()}}(e,n)}}),e.on("seeking",function(){var t=e.buffered,n=!1,r=e.currentTime;if(u.default.clear(),t.length){for(var i=0,a=t.length;i<a;i++)if(r>=t.start(i)&&r<=t.end(i)){n=!0;break}n||p(0,r)}else p(0,e.currentTime)}),e.on("pause",function(){u.default.clear()}),e.on("playing",function(){l&&clearTimeout(l)}),e.on("waiting",function(){var t=e.mp4;if(t&&t.meta){var n=e.getBufferedRange(),r=t.meta.videoDuration;r-e.currentTime<.5&&r-n[1]<.5?e.mse.endOfStream():(p(0,n[1]+1),l=setTimeout(function(){for(var t=e.buffered,n=void 0,r=0,i=t.length;r<i;r++)if((n=t.start(r))>=e.currentTime){e.currentTime=n;break}},1500))}}),e._replay=function(){u.default.clear(),e.mp4.bufferCache.clear(),m(e.mp4.url).then(function(t){var n=t[0],r=t[1];e.src=r.url,e.mp4=n,e.mse=r,e.currentTime=0,e.play()},function(t){f(e,t)})}}}else e.emit("error",new r("other",e.config.vid))})}]);